2021-12-15
Next steps: frm email JMW(2021-12-14)
So, if we can correct those three things, step 1 is complete!

Step 2a will be to merge this table with the table showing counts for each oligotype in 
   each sample to create the counts matrix (observation matrix) with these taxonomy labels attached.

Step 2b will be to convert counts to percents so we have a matrix of percent abundance of 
   each oligotype in each sample.

Step 3 will be to group the oligotypes into species:
take the 99 oligotypes characteristic of gut, group them into "99 gut oligotypes";
For the remaining oligotypes,
if overall % identity is <98.5%, discard (or put into "no close match in HOMD")
then combine all remaining oligotypes that map to the same species,
and create a new table with % abundance of each species in each sample.

2021-12-14
# Fields: bit score, % identity, % query coverage per hsp, subject title
blastn  -db ../BLASTDB_ABUND/HOMD_16S_rRNA_RefSeq_V15.22.p9.fasta -query V1V3_593_Firmicutes.fna -out test.out -outfmt '7 nident pident length mismatch qcovhsp qcovs stitle' -max_target_seqs 30
blastn  -db ../BLASTDB_ABUND/HOMD_16S_rRNA_RefSeq_V15.22.p9.fasta -query V1V3_593_Firmicutes.fna -out test4.out -outfmt 0 -num_descriptions 1 -num_alignments 1

HSP = High Scoring Pairs
# BLASTN 2.7.1+
# Query: V1V3_593_Firmicutes
# Database: ../BLASTDB_ABUND/HOMD_16S_rRNA_RefSeq_V15.22.p9.fasta
# Fields: identical, % identity, alignment length, mismatches, % query coverage per hsp, % query coverage per subject, subject title
# 30 hits found
245	95.703	256	11	100	100	096DO008 | Lachnospiraceae [G-2] bacterium HMT 096 | HMT-096 | Clone: DO008 | GB: AF385508 | Status: Unnamed | Preferred Habitat: Oral | Genome: Genome: no

identical == 245  == # of identities
q-sequence length == q.end
alignmentLength - mismatches == 245  == matched reg of subject sequence

alignmentLength = 256  == query sequence length


# Fields: identical, % identity, % query coverage per hsp, % query coverage per subject, subject title
blast_outfmt = "'7 qseqid bitscore nident qstart qend stitle'"
alignmentLength - mismatches - gaps/ query length == FULL_PCT_ID
same as identical/ query-length (q.end - q.start)
FullpctID

V1V3_591_Firmicutes	344	233	91.016	99	935_8649 | Fastidiosipila sanguinis | HMT-935 | Clone: nck255g10c1 | GB: KF098649 | Status: Named | Preferred Habitat: Unassigned | Genome: Genome: no

how to arrive at 99% col4

# Fields: %identity, alignment-length, mismatches, gap-opens, q.start, q.end, s.start, s.end, evalue,   bit-score
	      91.016	 256	           22	       1	      2	       256	  249	   504	  6.53e-96	344



Input file:
   Eren2014-FromDatasetS1-oligotypesV1V3.csv
From JMW:
           Our goal is to use column D (REP_SEQ) in a BLAST against HOMD 16S refSeq, 
           to recreate updated versions of columns J through P (best hit % identity, 
           best hit % coverage, number of HMTs that are equally best hits, 
           the names of these HMTs, 
           their HMT IDs, strain/clone numbers, and NCBI ID numbers.

Blast db is from HOMD refseq: 
    blastdb_refseq_V15.22.p9/HOMD_16S_rRNA_RefSeq_V15.22.p9.fasta*

2021-12-13
script is:
   eren2014_abundance_parser.py

USAGE:
   Run it first time:
      eren2014_abundance_parser.py -i Eren2014-FromDatasetS1-oligotypesV1V3.csv
   to create the *.fna and blast.sh and *.fna.out files
   Then run it again:
      eren2014_abundance_parser.py -parse
   To parse the *.fna.out files and create the final BLAST_PARSE_RESULT.csv  
